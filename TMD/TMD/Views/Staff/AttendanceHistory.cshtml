@model List<TMD.Models.Attendance>
@{
    ViewData["Title"] = "Lịch Sử Chấm Công";
    Layout = "~/Views/Shared/_LayoutStaff.cshtml";
}
<link href="~/css/attendance-history.css" rel="stylesheet" />
<!-- Page Header -->
<div class="page-header-modern">
    <div class="page-header-content">
        <div class="page-title-wrapper">
            <div class="page-icon">
                <i class="fas fa-history"></i>
            </div>
            <div>
                <h1 class="page-title">Lịch Sử Chấm Công</h1>
                <div class="page-breadcrumb">
                    <a href="/Staff/Dashboard"><i class="fas fa-home"></i> Dashboard</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>Lịch sử chấm công</span>
                </div>
            </div>
        </div>
        <div class="page-actions">
            <button class="btn-export" onclick="exportAttendance()">
                <i class="fas fa-file-excel"></i>
                Xuất Excel
            </button>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="stat-card stat-gradient-1">
        <div class="stat-icon">
            <i class="fas fa-calendar-check"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">@ViewBag.TotalRecords</div>
            <div class="stat-label">Tổng số ngày</div>
        </div>
        <div class="stat-trend">
            <i class="fas fa-arrow-up"></i>
            <span>Tháng này</span>
        </div>
    </div>

    <div class="stat-card stat-gradient-2">
        <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">@ViewBag.OnTimeCount</div>
            <div class="stat-label">Đúng giờ</div>
        </div>
        <div class="stat-trend success">
            <i class="fas fa-thumbs-up"></i>
            <span>Xuất sắc</span>
        </div>
    </div>

    <div class="stat-card stat-gradient-3">
        <div class="stat-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">@ViewBag.LateCount</div>
            <div class="stat-label">Đi muộn</div>
        </div>
        <div class="stat-trend warning">
            <i class="fas fa-clock"></i>
            <span>Cần cải thiện</span>
        </div>
    </div>

    <div class="stat-card stat-gradient-4">
        <div class="stat-icon">
            <i class="fas fa-hourglass-half"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">@ViewBag.TotalWorkHours.ToString("F1")h</div>
            <div class="stat-label">Tổng giờ làm</div>
        </div>
        <div class="stat-trend">
            <i class="fas fa-chart-line"></i>
            <span>Thống kê</span>
        </div>
    </div>
</div>

<!-- Attendance Table Card -->
<div class="modern-card">
    <div class="card-header-modern">
        <div class="header-left">
            <h5 class="card-title-modern">
                <i class="fas fa-list-ul"></i>
                Chi Tiết Chấm Công
            </h5>
            <p class="card-subtitle">Xem lịch sử chấm công chi tiết của bạn</p>
        </div>
        <div class="header-right">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Tìm kiếm theo ngày...">
            </div>
            <div class="filter-dropdown">
                <button class="btn-filter">
                    <i class="fas fa-filter"></i>
                    Lọc
                </button>
            </div>
        </div>
    </div>

    <div class="card-body-modern">
        @if (Model.Any())
        {
            <div class="table-container">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th width="60">
                                <div class="th-content">STT</div>
                            </th>
                            <th>
                                <div class="th-content">
                                    <i class="far fa-calendar"></i>
                                    Ngày làm việc
                                </div>
                            </th>
                            <th>
                                <div class="th-content">
                                    <i class="fas fa-sign-in-alt"></i>
                                    Check-in
                                </div>
                            </th>
                            <th>
                                <div class="th-content">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Check-out
                                </div>
                            </th>
                            <th>
                                <div class="th-content">
                                    <i class="fas fa-clock"></i>
                                    Tổng giờ
                                </div>
                            </th>
                            <th>
                                <div class="th-content">
                                    <i class="fas fa-info-circle"></i>
                                    Trạng thái
                                </div>
                            </th>
                            <th width="120">
                                <div class="th-content">Thao tác</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int index = 1;
                        }
                        @foreach (var item in Model)
                        {
                            <tr class="table-row-modern">
                                <td>
                                    <div class="index-badge">@index</div>
                                </td>
                                <td>
                                    <div class="date-cell">
                                        <div class="date-primary">@item.WorkDate.ToString("dd/MM/yyyy")</div>
                                        <div class="date-secondary">@item.WorkDate.ToString("dddd", new System.Globalization.CultureInfo("vi-VN"))</div>
                                    </div>
                                </td>
                                <td>
                                    @if (item.CheckInTime.HasValue)
                                    {
                                        <div class="time-badge time-in">
                                            <i class="fas fa-sign-in-alt"></i>
                                            <span>@item.CheckInTime.Value.ToString("HH:mm:ss")</span>
                                        </div>
                                    }
                                    else
                                    {
                                        <span class="text-muted-modern">—</span>
                                    }
                                </td>
                                <td>
                                    @if (item.CheckOutTime.HasValue)
                                    {
                                        <div class="time-badge time-out">
                                            <i class="fas fa-sign-out-alt"></i>
                                            <span>@item.CheckOutTime.Value.ToString("HH:mm:ss")</span>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="status-badge badge-pending">
                                            <i class="fas fa-clock"></i>
                                            Chưa checkout
                                        </div>
                                    }
                                </td>
                                <td>
                                    @if (item.TotalHours.HasValue && item.TotalHours > 0)
                                    {
                                        <div class="hours-display">
                                            <i class="fas fa-hourglass-half"></i>
                                            <strong>@item.TotalHours.Value.ToString("F2")h</strong>
                                        </div>
                                    }
                                    else
                                    {
                                        <span class="text-muted-modern">—</span>
                                    }
                                </td>
                                <td>
                                    <div class="status-group">
                                        @if (item.CheckInTime.HasValue && item.CheckOutTime.HasValue)
                                        {
                                            <div class="status-badge badge-success">
                                                <i class="fas fa-check-circle"></i>
                                                Hoàn thành
                                            </div>
                                        }
                                        else if (item.CheckInTime.HasValue)
                                        {
                                            <div class="status-badge badge-warning">
                                                <i class="fas fa-clock"></i>
                                                Đang làm việc
                                            </div>
                                        }

                                        @if (item.IsLate == true)
                                        {
                                            <div class="status-badge badge-late">
                                                <i class="fas fa-exclamation-triangle"></i>
                                                Đi muộn
                                            </div>
                                        }
                                        else if (item.IsLate == false && item.CheckInTime.HasValue)
                                        {
                                            <div class="status-badge badge-ontime">
                                                <i class="fas fa-check"></i>
                                                Đúng giờ
                                            </div>
                                        }
                                    </div>
                                </td>
                                <td>
                                    <button class="btn-action btn-view"
                                            onclick='viewDetails(@Html.Raw(Json.Serialize(new {
                                                workDate = item.WorkDate.ToString("yyyy-MM-dd"),
                                                checkInTime = item.CheckInTime?.ToString("yyyy-MM-ddTHH:mm:ss"),
                                                checkOutTime = item.CheckOutTime?.ToString("yyyy-MM-ddTHH:mm:ss"),
                                                totalHours = item.TotalHours ?? 0,
                                                checkInAddress = item.CheckInAddress ?? "",
                                                checkInPhotos = item.CheckInPhotos ?? "",
                                                checkOutAddress = item.CheckOutAddress ?? "",
                                                checkOutPhotos = item.CheckOutPhotos ?? "",
                                                isLate = item.IsLate ?? false
                                            })))'>
                                        <i class="fas fa-eye"></i>
                                        Chi tiết
                                    </button>
                                </td>
                            </tr>
                            index++;
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-calendar-times"></i>
                </div>
                <h3 class="empty-title">Chưa có dữ liệu chấm công</h3>
                <p class="empty-text">Bạn chưa có lịch sử chấm công nào. Hãy bắt đầu check-in ngay!</p>
                <a href="/Staff/Dashboard" class="btn-primary-modern">
                    <i class="fas fa-clock"></i>
                    Check-in ngay
                </a>
            </div>
        }
    </div>
</div>

<!-- Detail Modal -->
<div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content modal-modern">
            <div class="modal-header-modern">
                <div class="modal-title-wrapper">
                    <div class="modal-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <h5 class="modal-title-modern">Chi Tiết Chấm Công</h5>
                </div>
                <button type="button" class="btn-close-modern" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body-modern">
                <!-- Work Date Header -->
                <div class="detail-header">
                    <div class="detail-header-icon">
                        <i class="far fa-calendar-alt"></i>
                    </div>
                    <div class="detail-header-content">
                        <h6>Ngày làm việc</h6>
                        <p id="detailWorkDate">—</p>
                    </div>
                </div>

                <div class="detail-grid">
                    <!-- Check-in Section -->
                    <div class="detail-section section-checkin">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <h6 class="section-title">Thông tin Check-in</h6>
                        </div>
                        <div class="section-content">
                            <div class="info-row">
                                <div class="info-icon">
                                    <i class="far fa-clock"></i>
                                </div>
                                <div class="info-content">
                                    <label>Thời gian</label>
                                    <p id="detailCheckInTime">—</p>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="info-content">
                                    <label>Địa điểm</label>
                                    <p id="detailCheckInAddress" class="address-text">—</p>
                                </div>
                            </div>
                            <div class="info-row" id="checkInPhotoGroup" style="display: none;">
                                <div class="info-icon">
                                    <i class="fas fa-image"></i>
                                </div>
                                <div class="info-content">
                                    <label>Hình ảnh</label>
                                    <div class="photo-container" id="checkInPhotoContainer"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Check-out Section -->
                    <div class="detail-section section-checkout">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            <h6 class="section-title">Thông tin Check-out</h6>
                        </div>
                        <div class="section-content">
                            <div class="info-row">
                                <div class="info-icon">
                                    <i class="far fa-clock"></i>
                                </div>
                                <div class="info-content">
                                    <label>Thời gian</label>
                                    <p id="detailCheckOutTime">—</p>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-icon">
                                    <i class="fas fa-hourglass-half"></i>
                                </div>
                                <div class="info-content">
                                    <label>Tổng giờ làm</label>
                                    <p id="detailTotalHours" class="hours-highlight">—</p>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="info-content">
                                    <label>Địa điểm</label>
                                    <p id="detailCheckOutAddress" class="address-text">—</p>
                                </div>
                            </div>
                            <div class="info-row" id="checkOutPhotoGroup" style="display: none;">
                                <div class="info-icon">
                                    <i class="fas fa-image"></i>
                                </div>
                                <div class="info-content">
                                    <label>Hình ảnh</label>
                                    <div class="photo-container" id="checkOutPhotoContainer"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer-modern">
                <button type="button" class="btn-secondary-modern" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i>
                    Đóng
                </button>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="~/css/attendance-history.css">

@section Scripts {
    <script src="~/js/attendance-history.js"></script>
}