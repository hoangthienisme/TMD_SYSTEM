@model List<TMD.Models.PasswordResetHistory>
@{
    ViewData["Title"] = "Lịch sử reset mật khẩu";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/css/tasklist-ad.css" rel="stylesheet" />
<link href="~/css/passwordresethistory.css" rel="stylesheet" />

<style>
    :root {
        --primary: #ff6b6b;
        --primary-dark: #ff5252;
        --secondary: #ffd93d;
        --success: #51cf66;
        --info: #74c0fc;
        --warning: #ffd93d;
        --danger: #ff6b6b;
        --dark: #2d3436;
        --light-bg: #f5f7fa;
        --white: #ffffff;
        --text-muted: #868e96;
        --gray-100: #f1f3f5;
        --gray-200: #e9ecef;
        --gray-300: #dee2e6;
    }

    .tm-page-header {
        margin-bottom: 32px;
    }

    .tm-page-title {
        font-size: 28px;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 8px;
    }

    .tm-page-subtitle {
        font-size: 14px;
        color: var(--text-muted);
        margin: 0;
    }

    .tm-btn-back {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* Stats Cards */
    .tm-stats-card {
        background: var(--white);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--gray-200);
        transition: all 0.3s ease;
        display: flex;
        align-items: flex-start;
        gap: 16px;
    }

        .tm-stats-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

    .tm-stats-icon {
        width: 56px;
        height: 56px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        flex-shrink: 0;
    }

    .tm-stats-danger .tm-stats-icon {
        background: rgba(255, 107, 107, 0.1);
        color: var(--danger);
    }

    .tm-stats-warning .tm-stats-icon {
        background: rgba(255, 215, 61, 0.1);
        color: var(--warning);
    }

    .tm-stats-info .tm-stats-icon {
        background: rgba(116, 192, 252, 0.1);
        color: var(--info);
    }

    .tm-stats-content {
        flex: 1;
    }

    .tm-stats-label {
        font-size: 13px;
        color: var(--text-muted);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }

    .tm-stats-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--dark);
    }

    .tm-stats-trend {
        margin-left: auto;
        font-size: 24px;
        opacity: 0.3;
        align-self: center;
    }

    /* Card */
    .tm-card {
        background: var(--white);
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--gray-200);
        overflow: hidden;
    }

    .tm-card-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--gray-200);
    }

        .tm-card-header h5 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

    .tm-card-body-table {
        padding: 0;
        overflow-x: auto;
    }

    /* Table */
    .tm-table {
        width: 100%;
        border-collapse: collapse;
        margin: 0;
    }

        .tm-table thead {
            background: var(--gray-100);
        }

        .tm-table th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--gray-200);
        }

        .tm-table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            font-size: 14px;
            color: var(--dark);
        }

        .tm-table tbody tr {
            transition: all 0.2s ease;
        }

            .tm-table tbody tr:hover {
                background: var(--gray-100);
            }

    /* Timestamp */
    .tm-password-timestamp {
        display: flex;
        align-items: center;
        gap: 10px;
    }

        .tm-password-timestamp i {
            font-size: 18px;
            flex-shrink: 0;
        }

        .tm-password-timestamp div {
            line-height: 1.4;
        }

    /* User Info */
    .tm-password-user-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .tm-password-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 16px;
        border: 2px solid white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
        overflow: hidden;
    }

        .tm-password-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .tm-password-avatar span {
            display: flex;
            align-items: center;
            justify-content: center;
        }

    .tm-password-avatar--target {
        background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .tm-password-avatar--admin {
        background: linear-gradient(135deg, #ffa751, #ffe259);
    }

    .tm-password-user-name {
        font-weight: 600;
        color: var(--dark);
    }

    /* Reason */
    .tm-password-reason {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--text-muted);
    }

        .tm-password-reason i {
            color: var(--warning);
            flex-shrink: 0;
        }

    /* IP Badge */
    .tm-password-ip-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        background: var(--gray-100);
        color: var(--text-muted);
    }

    /* Empty State */
    .tm-empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
    }

        .tm-empty-state i {
            color: var(--gray-300);
        }

        .tm-empty-state h4 {
            color: var(--dark);
            margin-top: 16px;
        }

    .tm-text-muted {
        color: var(--text-muted);
    }

    /* Responsive */
    media (max-width: 768px) {
        .tm-page-title

    {
        font-size: 24px;
    }

    .tm-stats-value {
        font-size: 24px;
    }

    .tm-table th,
    .tm-table td {
        padding: 10px 12px;
        font-size: 12px;
    }

    .tm-password-avatar {
        width: 40px;
        height: 40px;
        font-size: 14px;
    }

    }
</style>

<div class="tm-container">
    <!-- PAGE HEADER -->
    <div class="tm-page-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="tm-page-title">
                    <i class="fas fa-key me-2"></i> Lịch sử reset mật khẩu
                </h2>
                <p class="tm-page-subtitle">Theo dõi tất cả hoạt động reset mật khẩu bởi Admin</p>
            </div>
            <a href="@Url.Action("Dashboard", "Admin")" class="tm-btn-back btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i> Quay lại
            </a>
        </div>
    </div>

    <!-- STATISTICS CARDS -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="tm-stats-card tm-stats-danger">
                <div class="tm-stats-icon">
                    <i class="fas fa-key"></i>
                </div>
                <div class="tm-stats-content">
                    <div class="tm-stats-label">Tổng lượt reset</div>
                    <div class="tm-stats-value">@Model.Count</div>
                </div>
                <div class="tm-stats-trend">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="tm-stats-card tm-stats-warning">
                <div class="tm-stats-icon">
                    <i class="fas fa-calendar-day"></i>
                </div>
                <div class="tm-stats-content">
                    <div class="tm-stats-label">Reset hôm nay</div>
                    <div class="tm-stats-value">@Model.Count(r => r.ResetTime.HasValue && r.ResetTime.Value.Date == DateTime.Today)</div>
                </div>
                <div class="tm-stats-trend">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="tm-stats-card tm-stats-info">
                <div class="tm-stats-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="tm-stats-content">
                    <div class="tm-stats-label">Người dùng đã reset</div>
                    <div class="tm-stats-value">@Model.Select(r => r.UserId).Distinct().Count()</div>
                </div>
                <div class="tm-stats-trend">
                    <i class="fas fa-user-shield"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- PASSWORD RESET TABLE -->
    <div class="tm-card">
        <div class="tm-card-header">
            <h5>
                <i class="fas fa-list me-2"></i>
                Danh sách lịch sử reset (@Model.Count)
            </h5>
        </div>
        <div class="tm-card-body tm-card-body-table">
            @if (Model.Any())
            {
                <div class="table-responsive">
                    <table class="tm-table table">
                        <thead>
                            <tr>
                                <th><i class="far fa-clock me-1"></i> Thời gian</th>
                                <th><i class="fas fa-user me-1"></i> Người dùng bị reset</th>
                                <th><i class="fas fa-user-shield me-1"></i> Người thực hiện</th>
                                <th><i class="fas fa-info-circle me-1"></i> Lý do</th>
                                <th><i class="fas fa-network-wired me-1"></i> IP Address</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var reset in Model)
                            {
                                <tr>
                                    <td>
                                        <div class="tm-password-timestamp">
                                            <i class="far fa-calendar-alt"></i>
                                            <div>
                                                <div class="fw-bold text-dark">@reset.ResetTime?.ToString("dd/MM/yyyy")</div>
                                                <small class="tm-text-muted">@reset.ResetTime?.ToString("HH:mm:ss")</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="tm-password-user-info">
                                            <div class="tm-password-avatar tm-password-avatar--target">
                                                @if (!string.IsNullOrEmpty(reset.User?.Avatar))
                                                {
                                                    <img src="@reset.User.Avatar" alt="@reset.User?.FullName"
                                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                    <span style="display:none;">@(reset.User?.FullName?.Substring(0, 1) ?? "?")</span>
                                                }
                                                else
                                                {
                                                    <span>@(reset.User?.FullName?.Substring(0, 1) ?? "?")</span>
                                                }
                                            </div>
                                            <div>
                                                <div class="tm-password-user-name">@(reset.User?.FullName ?? "N/A")</div>
                                                <small class="tm-text-muted">@@@(reset.User?.Username ?? "unknown")</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="tm-password-user-info">
                                            <div class="tm-password-avatar tm-password-avatar--admin">
                                                @if (!string.IsNullOrEmpty(reset.ResetByUser?.Avatar))
                                                {
                                                    <img src="@reset.ResetByUser.Avatar" alt="@reset.ResetByUser?.FullName"
                                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                    <span style="display:none;">@(reset.ResetByUser?.FullName?.Substring(0, 1) ?? "A")</span>
                                                }
                                                else
                                                {
                                                    <span>@(reset.ResetByUser?.FullName?.Substring(0, 1) ?? "A")</span>
                                                }
                                            </div>
                                            <div>
                                                <div class="tm-password-user-name">@(reset.ResetByUser?.FullName ?? "System")</div>
                                                <small class="text-warning">
                                                    <i class="fas fa-crown me-1"></i> Admin
                                                </small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="tm-password-reason">
                                            <i class="fas fa-comment-dots"></i>
                                            <span>@(reset.ResetReason ?? "Không có lý do")</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="tm-password-ip-badge">
                                            <i class="fas fa-globe me-1"></i>
                                            @(reset.Ipaddress ?? "N/A")
                                        </span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="tm-empty-state">
                    <i class="fas fa-key fa-5x"></i>
                    <h4 class="mt-3">Không có dữ liệu</h4>
                    <p class="tm-text-muted">Chưa có hoạt động reset mật khẩu nào được ghi nhận</p>
                </div>
            }
        </div>
    </div>
</div>